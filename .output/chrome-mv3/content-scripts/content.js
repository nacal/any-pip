var content=function(){"use strict";var R=Object.defineProperty;var z=(u,a,d)=>a in u?R(u,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[a]=d;var c=(u,a,d)=>z(u,typeof a!="symbol"?a+"":a,d);var I,C;function u(s){return s}const a=((C=(I=globalThis.browser)==null?void 0:I.runtime)==null?void 0:C.id)==null?globalThis.chrome:globalThis.browser,h=class h{constructor(){c(this,"state",{isSelecting:!1,highlightedElement:null});c(this,"listeners",new Set)}static getInstance(){return h.instance||(h.instance=new h),h.instance}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.notifyListeners()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){this.listeners.forEach(t=>t(this.getState()))}};c(h,"instance");let d=h;class l{static highlight(t){this.clearCurrentHighlight();const e=t;this.originalStyles={boxShadow:e.style.boxShadow,position:e.style.position,zIndex:e.style.zIndex},e.style.boxShadow="0 0 0 2px #ff0000",e.style.position="relative",e.style.zIndex="999999",this.store.setState({highlightedElement:t})}static clearHighlight(){this.clearCurrentHighlight(),this.store.setState({highlightedElement:null})}static clearCurrentHighlight(){const{highlightedElement:t}=this.store.getState();if(t){const e=t;e.style.boxShadow=this.originalStyles.boxShadow||"",e.style.position=this.originalStyles.position||"",e.style.zIndex=this.originalStyles.zIndex||"",this.originalStyles={}}}static start(){this.store.setState({isSelecting:!0}),document.body.style.cursor="crosshair"}static stop(){this.store.setState({isSelecting:!1}),document.body.style.cursor="default",this.clearHighlight()}static isSelecting(){return this.store.getState().isSelecting}}c(l,"store",d.getInstance()),c(l,"originalStyles",{});class E{static createStyleElement(t){const e=t.document.createElement("style");e.textContent=this.STYLES,t.document.head.appendChild(e)}static createSpinnerElement(t){const e=t.document.createElement("div");return e.style.cssText=`
      width: 30px;
      height: 30px;
      border: 3px solid #ffffff;
      border-top: 3px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    `,e}static show(t){this.createStyleElement(t);const e=t.document.createElement("div");e.id="pip-loading",e.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 8px;
      z-index: 999999;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    `;const i=this.createSpinnerElement(t),n=t.document.createElement("div");n.textContent="Loading...",e.appendChild(i),e.appendChild(n),t.document.body.appendChild(e)}static hide(t){const e=t.document.getElementById("pip-loading");e&&e.remove()}}c(E,"STYLES",`
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `);class K{static isSupported(){return"documentPictureInPicture"in window}static async createWindow(t){if(!this.isSupported()){alert("This browser does not support Document Picture-in-Picture");return}const e=t.getBoundingClientRect();try{const i=await window.documentPictureInPicture.requestWindow({width:e.width,height:e.height});E.show(i);try{await this.copyStyles(i),await this.setupPipWindow(i,t)}finally{E.hide(i)}}catch(i){console.error("Picture-in-Picture failed:",i)}}static setupPipWindow(t,e){const i=t.document.createElement("div"),{clone:n,wrapper:r}=this.cloneElementWithParents(e,t);i.style.height="100vh",i.style.overflow="auto",this.setupPipWindowStyles(t),i.appendChild(r),t.document.body.appendChild(i),t.addEventListener("pagehide",()=>t.close())}static cloneElementWithParents(t,e){const i=t.getBoundingClientRect(),n=Math.max(400,e.innerWidth);Math.min(1,n/i.width);const r=[];let o=t;for(;o&&o!==document.body;)r.unshift(o),o=o.parentElement;let m=null,P=null;return r.forEach((p,F)=>{const g=e.document.createElement(p.tagName.toLowerCase());m?P.appendChild(g):m=g,p.className&&(g.className=p.className),p.id&&(g.id=p.id),P=g,F===r.length-1&&(g.innerHTML=p.innerHTML)}),{clone:P,wrapper:m}}static setupPipWindowStyles(t){const e=t.document.body.style;e.margin="0",e.padding="0",e.width="100%",e.height="100%",e.boxSizing="border-box",e.overflow="hidden"}static async copyStyles(t){const e=document.querySelectorAll('style, link[rel="stylesheet"]');for(const i of e)if(i instanceof HTMLStyleElement)t.document.head.appendChild(i.cloneNode(!0));else if(i instanceof HTMLLinkElement)try{const n=await fetch(i.href);if(n.ok){const r=await n.text(),o=t.document.createElement("style");o.textContent=r,t.document.head.appendChild(o)}}catch(n){console.error("Failed to load stylesheet:",i.href,n)}}}const w={handleMouseOver(s){if(!l.isSelecting())return;const t=s.target;l.highlight(t),s.stopPropagation()},async handleClick(s){if(!l.isSelecting())return;s.preventDefault(),s.stopPropagation();const t=s.target;l.clearHighlight(),l.stop(),await K.createWindow(t)},handleKeyDown(s){s.key==="Escape"&&l.isSelecting()&&l.stop()}},L={matches:["<all_urls>"],main(){a.runtime.onMessage.addListener(s=>(s.type==="START_ELEMENT_SELECT"&&(l.isSelecting()?l.stop():l.start()),!0)),document.addEventListener("mouseover",w.handleMouseOver),document.addEventListener("click",w.handleClick),document.addEventListener("keydown",w.handleKeyDown)}};function f(s,...t){}const M={debug:(...s)=>f(console.debug,...s),log:(...s)=>f(console.log,...s),warn:(...s)=>f(console.warn,...s),error:(...s)=>f(console.error,...s)},S=class S extends Event{constructor(t,e){super(S.EVENT_NAME,{}),this.newUrl=t,this.oldUrl=e}};c(S,"EVENT_NAME",T("wxt:locationchange"));let v=S;function T(s){var t;return`${(t=a==null?void 0:a.runtime)==null?void 0:t.id}:content:${s}`}function _(s){let t,e;return{run(){t==null&&(e=new URL(location.href),t=s.setInterval(()=>{let i=new URL(location.href);i.href!==e.href&&(window.dispatchEvent(new v(i,e)),e=i)},1e3))}}}const y=class y{constructor(t,e){c(this,"isTopFrame",window.self===window.top);c(this,"abortController");c(this,"locationWatcher",_(this));this.contentScriptName=t,this.options=e,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(t){return this.abortController.abort(t)}get isInvalid(){return a.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(t){return this.signal.addEventListener("abort",t),()=>this.signal.removeEventListener("abort",t)}block(){return new Promise(()=>{})}setInterval(t,e){const i=setInterval(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearInterval(i)),i}setTimeout(t,e){const i=setTimeout(()=>{this.isValid&&t()},e);return this.onInvalidated(()=>clearTimeout(i)),i}requestAnimationFrame(t){const e=requestAnimationFrame((...i)=>{this.isValid&&t(...i)});return this.onInvalidated(()=>cancelAnimationFrame(e)),e}requestIdleCallback(t,e){const i=requestIdleCallback((...n)=>{this.signal.aborted||t(...n)},e);return this.onInvalidated(()=>cancelIdleCallback(i)),i}addEventListener(t,e,i,n){var r;e==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(r=t.addEventListener)==null||r.call(t,e.startsWith("wxt:")?T(e):e,i,{...n,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),M.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:y.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName},"*")}listenForNewerScripts(t){let e=!0;const i=n=>{var r,o;if(((r=n.data)==null?void 0:r.type)===y.SCRIPT_STARTED_MESSAGE_TYPE&&((o=n.data)==null?void 0:o.contentScriptName)===this.contentScriptName){const m=e;if(e=!1,m&&(t!=null&&t.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",i),this.onInvalidated(()=>removeEventListener("message",i))}};c(y,"SCRIPT_STARTED_MESSAGE_TYPE",T("wxt:content-script-started"));let x=y;const N=Symbol("null");let k=0;class A extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[t]=arguments;if(t!=null){if(typeof t[Symbol.iterator]!="function")throw new TypeError(typeof t+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[e,i]of t)this.set(e,i)}}_getPublicKeys(t,e=!1){if(!Array.isArray(t))throw new TypeError("The keys parameter must be an array");const i=this._getPrivateKey(t,e);let n;return i&&this._publicKeys.has(i)?n=this._publicKeys.get(i):e&&(n=[...t],this._publicKeys.set(i,n)),{privateKey:i,publicKey:n}}_getPrivateKey(t,e=!1){const i=[];for(let n of t){n===null&&(n=N);const r=typeof n=="object"||typeof n=="function"?"_objectHashes":typeof n=="symbol"?"_symbolHashes":!1;if(!r)i.push(n);else if(this[r].has(n))i.push(this[r].get(n));else if(e){const o=`@@mkm-ref-${k++}@@`;this[r].set(n,o),i.push(o)}else return!1}return JSON.stringify(i)}set(t,e){const{publicKey:i}=this._getPublicKeys(t,!0);return super.set(i,e)}get(t){const{publicKey:e}=this._getPublicKeys(t);return super.get(e)}has(t){const{publicKey:e}=this._getPublicKeys(t);return super.has(e)}delete(t){const{publicKey:e,privateKey:i}=this._getPublicKeys(t);return!!(e&&super.delete(e)&&this._publicKeys.delete(i))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}new A;function D(){}function b(s,...t){}const H={debug:(...s)=>b(console.debug,...s),log:(...s)=>b(console.log,...s),warn:(...s)=>b(console.warn,...s),error:(...s)=>b(console.error,...s)};return(async()=>{try{const{main:s,...t}=L,e=new x("content",t);return await s(e)}catch(s){throw H.error('The content script "content" crashed on startup!',s),s}})()}();
content;
